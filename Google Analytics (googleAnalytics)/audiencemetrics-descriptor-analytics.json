{
  "name": "Google Analytics Audience Metrics",
  "description": "See how your Users, Sessions, and Pageviews trend over time. Originates from the Gallery.",
  "sampleFormulas": {
    "326ff35b": {
      "txt": "\"20151031\"",
      "src": {
        "t": "expr",
        "v": false,
        "c": [
          {
            "t": "l",
            "v": "20151031"
          }
        ]
      }
    },
    "6736c72b": {
      "txt": "\"20151129\"",
      "src": {
        "t": "expr",
        "v": false,
        "c": [
          {
            "t": "l",
            "v": "20151129"
          }
        ]
      }
    },
    "8019843e": {
      "txt": "\"-30\"",
      "src": {
        "t": "expr",
        "v": false,
        "c": [
          {
            "t": "l",
            "v": "-30"
          }
        ]
      }
    },
    "f13f9611": {
      "txt": "\"Last 30 Days\"",
      "src": {
        "t": "expr",
        "v": false,
        "c": [
          {
            "t": "l",
            "v": "Last 30 Days"
          }
        ]
      }
    },
    "9c38e957": {
      "txt": "array(\"4200\",\"6920\",\"4507\",\"4762\",\"4836\",\"8716\",\"4551\",\"3244\",\"6880\",\"7296\",\"3825\",\"6934\",\"4415\",\"5585\",\"3928\",\"8660\",\"2079\",\"3849\",\"9345\",\"7258\",\"3708\",\"2530\",\"8474\",\"3226\",\"6102\",\"3486\",\"5177\",\"8470\",\"3743\",\"9929\")",
      "src": {
        "t": "expr",
        "v": false,
        "c": [
          {
            "t": "f",
            "v": "array",
            "c": [
              {
                "t": "l",
                "v": "4200"
              },
              {
                "t": "l",
                "v": "6920"
              },
              {
                "t": "l",
                "v": "4507"
              },
              {
                "t": "l",
                "v": "4762"
              },
              {
                "t": "l",
                "v": "4836"
              },
              {
                "t": "l",
                "v": "8716"
              },
              {
                "t": "l",
                "v": "4551"
              },
              {
                "t": "l",
                "v": "3244"
              },
              {
                "t": "l",
                "v": "6880"
              },
              {
                "t": "l",
                "v": "7296"
              },
              {
                "t": "l",
                "v": "3825"
              },
              {
                "t": "l",
                "v": "6934"
              },
              {
                "t": "l",
                "v": "4415"
              },
              {
                "t": "l",
                "v": "5585"
              },
              {
                "t": "l",
                "v": "3928"
              },
              {
                "t": "l",
                "v": "8660"
              },
              {
                "t": "l",
                "v": "2079"
              },
              {
                "t": "l",
                "v": "3849"
              },
              {
                "t": "l",
                "v": "9345"
              },
              {
                "t": "l",
                "v": "7258"
              },
              {
                "t": "l",
                "v": "3708"
              },
              {
                "t": "l",
                "v": "2530"
              },
              {
                "t": "l",
                "v": "8474"
              },
              {
                "t": "l",
                "v": "3226"
              },
              {
                "t": "l",
                "v": "6102"
              },
              {
                "t": "l",
                "v": "3486"
              },
              {
                "t": "l",
                "v": "5177"
              },
              {
                "t": "l",
                "v": "8470"
              },
              {
                "t": "l",
                "v": "3743"
              },
              {
                "t": "l",
                "v": "9929"
              }
            ]
          }
        ]
      }
    },
    "edf20455": {
      "txt": "array(\"6518\",\"2786\",\"6994\",\"5164\",\"2212\",\"5431\",\"2153\",\"6049\",\"4124\",\"7485\",\"4221\",\"7076\",\"2078\",\"2871\",\"7962\",\"2062\",\"3584\",\"5752\",\"6350\",\"7269\",\"5769\",\"7980\",\"5054\",\"5873\",\"4684\",\"7166\",\"4362\",\"6210\",\"3211\",\"4739\")",
      "src": {
        "t": "expr",
        "v": false,
        "c": [
          {
            "t": "f",
            "v": "array",
            "c": [
              {
                "t": "l",
                "v": "6518"
              },
              {
                "t": "l",
                "v": "2786"
              },
              {
                "t": "l",
                "v": "6994"
              },
              {
                "t": "l",
                "v": "5164"
              },
              {
                "t": "l",
                "v": "2212"
              },
              {
                "t": "l",
                "v": "5431"
              },
              {
                "t": "l",
                "v": "2153"
              },
              {
                "t": "l",
                "v": "6049"
              },
              {
                "t": "l",
                "v": "4124"
              },
              {
                "t": "l",
                "v": "7485"
              },
              {
                "t": "l",
                "v": "4221"
              },
              {
                "t": "l",
                "v": "7076"
              },
              {
                "t": "l",
                "v": "2078"
              },
              {
                "t": "l",
                "v": "2871"
              },
              {
                "t": "l",
                "v": "7962"
              },
              {
                "t": "l",
                "v": "2062"
              },
              {
                "t": "l",
                "v": "3584"
              },
              {
                "t": "l",
                "v": "5752"
              },
              {
                "t": "l",
                "v": "6350"
              },
              {
                "t": "l",
                "v": "7269"
              },
              {
                "t": "l",
                "v": "5769"
              },
              {
                "t": "l",
                "v": "7980"
              },
              {
                "t": "l",
                "v": "5054"
              },
              {
                "t": "l",
                "v": "5873"
              },
              {
                "t": "l",
                "v": "4684"
              },
              {
                "t": "l",
                "v": "7166"
              },
              {
                "t": "l",
                "v": "4362"
              },
              {
                "t": "l",
                "v": "6210"
              },
              {
                "t": "l",
                "v": "3211"
              },
              {
                "t": "l",
                "v": "4739"
              }
            ]
          }
        ]
      }
    },
    "9549c956": {
      "txt": "array(\"18910\",\"20515\",\"16244\",\"11801\",\"12270\",\"12406\",\"19551\",\"11882\",\"9476\",\"16170\",\"16937\",\"10544\",\"16269\",\"11632\",\"13785\",\"10734\",\"19449\",\"7329\",\"10588\",\"20710\",\"16867\",\"10330\",\"8161\",\"19106\",\"9441\",\"14738\",\"9920\",\"13035\",\"19099\",\"10394\")",
      "src": {
        "t": "expr",
        "v": false,
        "c": [
          {
            "t": "f",
            "v": "array",
            "c": [
              {
                "t": "l",
                "v": "18910"
              },
              {
                "t": "l",
                "v": "20515"
              },
              {
                "t": "l",
                "v": "16244"
              },
              {
                "t": "l",
                "v": "11801"
              },
              {
                "t": "l",
                "v": "12270"
              },
              {
                "t": "l",
                "v": "12406"
              },
              {
                "t": "l",
                "v": "19551"
              },
              {
                "t": "l",
                "v": "11882"
              },
              {
                "t": "l",
                "v": "9476"
              },
              {
                "t": "l",
                "v": "16170"
              },
              {
                "t": "l",
                "v": "16937"
              },
              {
                "t": "l",
                "v": "10544"
              },
              {
                "t": "l",
                "v": "16269"
              },
              {
                "t": "l",
                "v": "11632"
              },
              {
                "t": "l",
                "v": "13785"
              },
              {
                "t": "l",
                "v": "10734"
              },
              {
                "t": "l",
                "v": "19449"
              },
              {
                "t": "l",
                "v": "7329"
              },
              {
                "t": "l",
                "v": "10588"
              },
              {
                "t": "l",
                "v": "20710"
              },
              {
                "t": "l",
                "v": "16867"
              },
              {
                "t": "l",
                "v": "10330"
              },
              {
                "t": "l",
                "v": "8161"
              },
              {
                "t": "l",
                "v": "19106"
              },
              {
                "t": "l",
                "v": "9441"
              },
              {
                "t": "l",
                "v": "14738"
              },
              {
                "t": "l",
                "v": "9920"
              },
              {
                "t": "l",
                "v": "13035"
              },
              {
                "t": "l",
                "v": "19099"
              },
              {
                "t": "l",
                "v": "10394"
              }
            ]
          }
        ]
      }
    },
    "13fcee13": {
      "txt": "array(\"Oct 31\",\"Nov 01\",\"Nov 02\",\"Nov 03\",\"Nov 04\",\"Nov 05\",\"Nov 06\",\"Nov 07\",\"Nov 08\",\"Nov 09\",\"Nov 10\",\"Nov 11\",\"Nov 12\",\"Nov 13\",\"Nov 14\",\"Nov 15\",\"Nov 16\",\"Nov 17\",\"Nov 18\",\"Nov 19\",\"Nov 20\",\"Nov 21\",\"Nov 22\",\"Nov 23\",\"Nov 24\",\"Nov 25\",\"Nov 26\",\"Nov 27\",\"Nov 28\",\"Nov 29\")",
      "src": {
        "t": "expr",
        "v": false,
        "c": [
          {
            "t": "f",
            "v": "array",
            "c": [
              {
                "t": "l",
                "v": "Oct 31"
              },
              {
                "t": "l",
                "v": "Nov 01"
              },
              {
                "t": "l",
                "v": "Nov 02"
              },
              {
                "t": "l",
                "v": "Nov 03"
              },
              {
                "t": "l",
                "v": "Nov 04"
              },
              {
                "t": "l",
                "v": "Nov 05"
              },
              {
                "t": "l",
                "v": "Nov 06"
              },
              {
                "t": "l",
                "v": "Nov 07"
              },
              {
                "t": "l",
                "v": "Nov 08"
              },
              {
                "t": "l",
                "v": "Nov 09"
              },
              {
                "t": "l",
                "v": "Nov 10"
              },
              {
                "t": "l",
                "v": "Nov 11"
              },
              {
                "t": "l",
                "v": "Nov 12"
              },
              {
                "t": "l",
                "v": "Nov 13"
              },
              {
                "t": "l",
                "v": "Nov 14"
              },
              {
                "t": "l",
                "v": "Nov 15"
              },
              {
                "t": "l",
                "v": "Nov 16"
              },
              {
                "t": "l",
                "v": "Nov 17"
              },
              {
                "t": "l",
                "v": "Nov 18"
              },
              {
                "t": "l",
                "v": "Nov 19"
              },
              {
                "t": "l",
                "v": "Nov 20"
              },
              {
                "t": "l",
                "v": "Nov 21"
              },
              {
                "t": "l",
                "v": "Nov 22"
              },
              {
                "t": "l",
                "v": "Nov 23"
              },
              {
                "t": "l",
                "v": "Nov 24"
              },
              {
                "t": "l",
                "v": "Nov 25"
              },
              {
                "t": "l",
                "v": "Nov 26"
              },
              {
                "t": "l",
                "v": "Nov 27"
              },
              {
                "t": "l",
                "v": "Nov 28"
              },
              {
                "t": "l",
                "v": "Nov 29"
              }
            ]
          }
        ]
      }
    }
  },
  "datasources": {
    "googleAnalytics-01": {
      "service": "google_analytics",
      "libraryAlias": "GAWebsiteKpiLast731Days",
      "name": "Google Analytics KPIs by Day (Last 731 Days)",
      "description": "Shows KPI's including Users, Sessions, Bounce Rate, Avg. Session Duration, and more, for the last 731 days. Originates from the Gallery.",
      "type": "google_analytics",
      "format": "csv",
      "refreshInterval": 14400,
      "props": {
        "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&dimensions=ga:date&metrics=ga:users,ga:newUsers,ga:percentNewSessions,ga:sessions,ga:bounces,ga:bounceRate,ga:avgSessionDuration,ga:goalStartsAll,ga:pageviews,ga:pageviewsPerSession&start-date={date.add(-730).format()}&end-date={date.today}&max-results=10000",
        "max_pages": "1",
        "mode": "Simple",
        "profile": "{{ds.google_analytics.profileId}}",
        "timePeriod": "&start-date={date.startOfYear}&end-date={date.today}"
      }
    },
    "googleAnalytics-02": {
      "service": "google_analytics",
      "libraryAlias": "GAWebsiteKpiLast90Days",
      "name": "Google Analytics KPIs by Month (Last 90 Days)",
      "description": "Users, Sessions and Pageviews by month for the last 90 days. Originates from the Gallery.",
      "type": "google_analytics",
      "format": "csv",
      "refreshInterval": 14400,
      "props": {
        "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&start-date={date.add(-90).format()}&end-date=yesterday&metrics=ga:users,ga:sessions,ga:pageviews&dimensions=ga:month,ga:year&sort=-ga:month&max-results=10000",
        "max_pages": "1",
        "mode": "Simple",
        "profile": "{{ds.google_analytics.profileId}}",
        "timePeriod": "&start-date={date.startOfYear}&end-date={date.yesterday}"
      }
    },
    "googleAnalytics-03": {
      "service": "google_analytics",
      "libraryAlias": "GAWebsiteKpiCurrentYear",
      "name": "Google Analytics KPIs by Month (This Year)",
      "description": "Users, Sessions and Pageviews by month for the current year. Originates from the Gallery.",
      "type": "google_analytics",
      "format": "csv",
      "refreshInterval": 14400,
      "props": {
        "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&start-date={date.startOfYear.format()}&end-date=today&metrics=ga:users,ga:sessions,ga:pageviews&dimensions=ga:month,ga:year&sort=-ga:month&max-results=10000",
        "max_pages": "1",
        "mode": "Simple",
        "profile": "{{ds.google_analytics.profileId}}",
        "timePeriod": "&start-date={date.startOfYear}&end-date={date.today}"
      }
    },
    "googleAnalytics-04": {
      "service": "google_analytics",
      "libraryAlias": "GAWebsiteKpiLast365Days",
      "name": "Google Analytics KPIs by Month (Last 365 Days)",
      "description": "Users, sessions and pageviews by month for the last 365 days. Originates from the Gallery.",
      "type": "google_analytics",
      "format": "csv",
      "refreshInterval": 14400,
      "props": {
        "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&start-date={date.add(-365).format()}&end-date=yesterday&metrics=ga:users,ga:sessions,ga:pageviews&dimensions=ga:month,ga:year&sort=-ga:month&max-results=10000",
        "max_pages": "1",
        "mode": "Simple",
        "profile": "{{ds.google_analytics.profileId}}",
        "timePeriod": "&start-date={date.startOfYear}&end-date={date.yesterday}"
      }
    }
  },
  "uiVariables": [
    {
      "name": "KTPeriod",
      "value": "-30"
    }
  ],
  "dsMappings": {
    "googleAnalytics-01": "c6b3e6cd35cadfb3bd71natceewzhere",
    "googleAnalytics-02": "9b0e6dee9e56a3039130natceewzhere",
    "googleAnalytics-03": "ad7dbc438e0c5d4792fdnatceewzhere",
    "googleAnalytics-04": "4b4f3b4f2f5140e7982anatceewzhere"
  },
  "services": [
    {
      "service": "google_analytics"
    }
  ],
  "datasourceConfigModel": [
    {
      "type": "select",
      "id": "ds.google_analytics.profileId",
      "label": "Analytics Account",
      "description": "Select an Analytics Account from the drop-down list.",
      "isRequired": true
    }
  ],
  "queries": [
    {
      "errorMessage": "Here are two suggestions:<br><br>1. Make sure you have access to your company's Google Analytics account. <br><br>2. From time to time, your Google OAuth token will expire. This token allows you to safely bring your data into Klipfolio. <a href='http://klipfolio.uservoice.com/knowledgebase/articles/404228-oauth-token-expired' target='_blank'>Find out how to re-authorize your OAuth tokens</a>.",
      "connector": {
        "service": "google_analytics",
        "type": "simple_rest",
        "format": "json",
        "props": {
          "endpoint_url": "https://www.googleapis.com/analytics/v3/management/accounts/~all/webproperties/~all/profiles?fields=items(id%2Cname%2Cpermissions%2CwebPropertyId%2CwebsiteUrl)",
          "method": "GET"
        }
      },
      "results": [
        {
          "propId": "ds.google_analytics.profileId",
          "propField": "options",
          "labels": "/items/name",
          "values": "/items/id"
        }
      ]
    }
  ]
}