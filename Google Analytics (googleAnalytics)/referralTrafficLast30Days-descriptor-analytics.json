{
    "name": "Google Analytics Referral Traffic (Last 30 Days)",
    "description": "See referral traffic for last 30 days. Originates from the Gallery.",
    "sampleFormulas": {
        "b19d296b-2": {
            "txt": "array(\"http://facebook.com/\",\"http://moz.com/blog/let-data-take-the-wheel\",\"http://duckduckgo.com/\",\"http://google.fr/imgres\",\"http://ca.indeed.com/jobs\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [
                    {
                        "t": "f",
                        "v": "array",
                        "c": [
                            {
                                "t": "l",
                                "v": "http://facebook.com/"
                            },
                            {
                                "t": "l",
                                "v": "http://moz.com/blog/let-data-take-the-wheel"
                            },
                            {
                                "t": "l",
                                "v": "http://duckduckgo.com/"
                            },
                            {
                                "t": "l",
                                "v": "http://google.fr/imgres"
                            },
                            {
                                "t": "l",
                                "v": "http://ca.indeed.com/jobs"
                            }
                        ]
                    }
                ]
            }
        },
        "4a9ac4ff-4": {
            "txt": "array(\"2160\",\"1114\",\"1102\",\"994\",\"669\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [
                    {
                        "t": "f",
                        "v": "array",
                        "c": [
                            {
                                "t": "l",
                                "v": "2160"
                            },
                            {
                                "t": "l",
                                "v": "1114"
                            },
                            {
                                "t": "l",
                                "v": "1102"
                            },
                            {
                                "t": "l",
                                "v": "994"
                            },
                            {
                                "t": "l",
                                "v": "669"
                            }
                        ]
                    }
                ]
            }
        },
        "5eb4ac4d-6": {
            "txt": "array(\"36\",\"42\",\"19\",\"4\",\"9\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [
                    {
                        "t": "f",
                        "v": "array",
                        "c": [
                            {
                                "t": "l",
                                "v": "36"
                            },
                            {
                                "t": "l",
                                "v": "42"
                            },
                            {
                                "t": "l",
                                "v": "19"
                            },
                            {
                                "t": "l",
                                "v": "4"
                            },
                            {
                                "t": "l",
                                "v": "9"
                            }
                        ]
                    }
                ]
            }
        },
        "de027e3d-8": {
            "txt": "array(\"1.4599\",\"2.2249\",\"2.1212\",\"17.17464\",\"9.99424\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [
                    {
                        "t": "f",
                        "v": "array",
                        "c": [
                            {
                                "t": "l",
                                "v": "1.4599"
                            },
                            {
                                "t": "l",
                                "v": "2.2249"
                            },
                            {
                                "t": "l",
                                "v": "2.1212"
                            },
                            {
                                "t": "l",
                                "v": "17.17464"
                            },
                            {
                                "t": "l",
                                "v": "9.99424"
                            }
                        ]
                    }
                ]
            }
        },
        "de027e3d-8": {
            "txt": "array(\"0.04599\",\"0.02249\",\"0.01212\",\"0.017464\",\"0.099424\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [
                    {
                        "t": "f",
                        "v": "array",
                        "c": [
                            {
                                "t": "l",
                                "v": "0.04599"
                            },
                            {
                                "t": "l",
                                "v": "0.02249"
                            },
                            {
                                "t": "l",
                                "v": "0.01212"
                            },
                            {
                                "t": "l",
                                "v": "0.017464"
                            },
                            {
                                "t": "l",
                                "v": "0.099424"
                            }
                        ]
                    }
                ]
            }
        },
        "b5c47992-10": {
            "txt": "array(\"0.05699\",\"0.05949\",\"0.04412\",\"0.042464\",\"0.019424\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [
                    {
                        "t": "f",
                        "v": "array",
                        "c": [
                            {
                                "t": "l",
                                "v": "0.05699"
                            },
                            {
                                "t": "l",
                                "v": "0.05949"
                            },
                            {
                                "t": "l",
                                "v": "0.04412"
                            },
                            {
                                "t": "l",
                                "v": "0.042464"
                            },
                            {
                                "t": "l",
                                "v": "0.019424"
                            }
                        ]
                    }
                ]
            }
        },
        "a197d55c-14": {
            "txt": "array(\"194.496\",\"274.44622\",\"229.9900\",\"139.4679\",\"99.0924\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [
                    {
                        "t": "f",
                        "v": "array",
                        "c": [
                            {
                                "t": "l",
                                "v": "194.496"
                            },
                            {
                                "t": "l",
                                "v": "274.44622"
                            },
                            {
                                "t": "l",
                                "v": "229.9900"
                            },
                            {
                                "t": "l",
                                "v": "139.4679"
                            },
                            {
                                "t": "l",
                                "v": "99.0924"
                            }
                        ]
                    }
                ]
            }
        }
    },
    "datasources": {
        "googleAnalytics": {
            "service": "google_analytics",
            "libraryAlias": "GoogleAnalyticsReferralTrafficLast30Days",
            "name": "Google Analytics Referral Traffic (Last 30 Days)",
            "description": "Shows referral traffic for the last 30 days. Originates from the Gallery.",
            "type": "google_analytics",
            "format": "csv",
            "refreshInterval": 14400,
            "props": {
                "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&metrics=ga%3Ausers%2Cga%3Asessions%2Cga%3AbounceRate%2Cga%3Agoal12Starts%2Cga%3AgoalCompletionsAll%2Cga%3AgoalConversionRateAll%2Cga%3AavgTimeOnPage&dimensions=ga%3AfullReferrer&filters=ga%3AreferralPath!%3D(not%20set)%3Bga%3Asessions%3E2&start-date={date.add(-30).format()}&end-date={date.yesterday}&max-results=10000",
                "advancedQuery": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&metrics=ga%3Ausers%2Cga%3Asessions%2Cga%3AbounceRate%2Cga%3Agoal12Starts%2Cga%3AgoalCompletionsAll%2Cga%3AgoalConversionRateAll%2Cga%3AavgTimeOnPage&dimensions=ga%3AfullReferrer&filters=ga%3AreferralPath!%3D(not%20set)%3Bga%3Asessions%3E2&start-date={date.add(-30).format()}&end-date={date.yesterday}&max-results=10000",
                "max_pages": "10",
                "mode": "Advanced",
                "profile": "{{ds.google_analytics.profileId}}",
                "timePeriod": "&start-date={date.add(-30).format()}&end-date={date.yesterday}"
            }
        }
    },
    "dsMappings": {
        "googleAnalytics": "23690fc03062f85a1938KavyaMallur9"
    },
    "services": [
        {
            "service": "google_analytics"
        }
    ],
    "datasourceConfigModel": [
        {
            "type": "select",
            "id": "ds.google_analytics.profileId",
            "label": "Analytics Account",
            "description": "Select an Analytics Account from the drop-down list.",
            "isRequired": true
        }
    ],
    "queries": [
        {
            "errorMessage": "Here are two suggestions:<br><br>1. Make sure you have access to your company's Google Analytics account. <br><br>2. From time to time, your Google OAuth token will expire. This token allows you to safely bring your data into Klipfolio. <a href='http://klipfolio.uservoice.com/knowledgebase/articles/404228-oauth-token-expired' target='_blank'>Find out how to re-authorize your OAuth tokens</a>.",
            "connector": {
                "service": "google_analytics",
                "type": "simple_rest",
                "format": "json",
                "props": {
                    "endpoint_url": "https://www.googleapis.com/analytics/v3/management/accounts/~all/webproperties/~all/profiles?fields=items(id%2Cname%2Cpermissions%2CwebPropertyId%2CwebsiteUrl)",
                    "method": "GET"
                }
            },
            "results": [
                {
                    "propId": "ds.google_analytics.profileId",
                    "propField": "options",
                    "labels": "/items/name",
                    "values": "/items/id"
                }
            ]
        }
    ]
}