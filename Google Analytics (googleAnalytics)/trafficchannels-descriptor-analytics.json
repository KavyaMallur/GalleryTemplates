{
    "name": "Google Analytics Traffic Channels",
    "description": "Displays the top online channels generating traffic to your website during the time period of your choice. Originates from the Gallery.",
    "sampleFormulas": {
        "db09c894": {
            "txt": "\"20150401\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "20150401"
                }]
            }
        },
        "b1ef654c": {
            "txt": "\"20150302\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "20150302"
                }]
            }
        },
        "d97c3099": {
            "txt": "\"20150430\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "20150430"
                }]
            }
        },
        "026933c4": {
            "txt": "\"20150331\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "20150331"
                }]
            }
        },
        "da43c901": {
            "txt": "\"-30\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "-30"
                }]
            }
        },
        "abcb0933": {
            "txt": "\"Last 30 Days\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Last 30 Days"
                }]
            }
        },
        "ae5eec4f": {
            "txt": "array(\"organic\",\"cpc\",\"direct\",\"referral\",\"retargetting\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "organic"
                    }, {
                        "t": "l",
                        "v": "cpc"
                    }, {
                        "t": "l",
                        "v": "direct"
                    }, {
                        "t": "l",
                        "v": "referral"
                    }, {
                        "t": "l",
                        "v": "retargetting"
                    }]
                }]
            }
        },
        "3ca24acf": {
            "txt": "array(\"217883\",\"172333\",\"121528\",\"16529\",\"12565\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "217883"
                    }, {
                        "t": "l",
                        "v": "172333"
                    }, {
                        "t": "l",
                        "v": "121528"
                    }, {
                        "t": "l",
                        "v": "16529"
                    }, {
                        "t": "l",
                        "v": "12565"
                    }]
                }]
            }
        },
        "070be1dd": {
            "txt": "array(\"217544\",\"138230\",\"122547\",\"17929\",\"10564\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "217544"
                    }, {
                        "t": "l",
                        "v": "138230"
                    }, {
                        "t": "l",
                        "v": "122547"
                    }, {
                        "t": "l",
                        "v": "17929"
                    }, {
                        "t": "l",
                        "v": "10564"
                    }]
                }]
            }
        },
        "c04e2dce": {
            "txt": "array(\"-0.0015\",\"0.2467\",\"-0.0083\",\"0.0780\",\"0.1894\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "-0.0015"
                    }, {
                        "t": "l",
                        "v": "0.2467"
                    }, {
                        "t": "l",
                        "v": "-0.0083"
                    }, {
                        "t": "l",
                        "v": "-0.0780"
                    }, {
                        "t": "l",
                        "v": "0.1894"
                    }]
                }]
            }
        },
        "cb8df27e": {
            "txt": "array(\"15,9126,9420,9337,1336,0615,2143,9431,1046,7614,0428,1726,1022,8745,4622,7537,6948,1546,0020,3248,7326,0833,228,9830,117,6035,917,2429,8639,5410,27\",\"19,5839,4339,718,0638,3324,4913,3948,9314,6340,5849,5513,4044,9241,7315,1835,4348,483,8042,7012,4328,2626,3446,7520,0030,6148,731,9528,6821,7231,32\",\"22,7741,2920,4431,2330,3043,343,7435,914,8931,5911,633,242,5711,0943,8048,5129,6610,1533,078,393,4813,3426,8722,1231,4331,0616,137,888,4436,16\",\"24,0625,441,9729,7714,0811,5313,5711,2120,7711,9722,4548,2433,9315,6139,0439,2928,093,0619,216,4742,6837,5545,2247,018,8442,619,505,9636,157,32\",\"37,8815,9540,275,9219,7718,8515,617,9233,1431,5617,8911,5835,8238,2524,1835,4841,5625,9825,647,7235,6019,5439,9629,0218,8523,0823,021,6925,7747,31\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "15,9126,9420,9337,1336,0615,2143,9431,1046,7614,0428,1726,1022,8745,4622,7537,6948,1546,0020,3248,7326,0833,228,9830,117,6035,917,2429,8639,5410,27"
                    }, {
                        "t": "l",
                        "v": "19,5839,4339,718,0638,3324,4913,3948,9314,6340,5849,5513,4044,9241,7315,1835,4348,483,8042,7012,4328,2626,3446,7520,0030,6148,731,9528,6821,7231,32"
                    }, {
                        "t": "l",
                        "v": "22,7741,2920,4431,2330,3043,343,7435,914,8931,5911,633,242,5711,0943,8048,5129,6610,1533,078,393,4813,3426,8722,1231,4331,0616,137,888,4436,16"
                    }, {
                        "t": "l",
                        "v": "24,0625,441,9729,7714,0811,5313,5711,2120,7711,9722,4548,2433,9315,6139,0439,2928,093,0619,216,4742,6837,5545,2247,018,8442,619,505,9636,157,32"
                    }, {
                        "t": "l",
                        "v": "37,8815,9540,275,9219,7718,8515,617,9233,1431,5617,8911,5835,8238,2524,1835,4841,5625,9825,647,7235,6019,5439,9629,0218,8523,0823,021,6925,7747,31"
                    }]
                }]
            }
        }
    },
    "datasources": {
        "googleAnalytics": {
            "service": "google_analytics",
            "libraryAlias": "GAChannelDefaultGrouping731 Days",
            "name": "GA Channel Default Grouping (731 Days)",
            "description": "Shows the number of sessions by day, broken down by traffic channels for the last 730 days to date. Originates from the Gallery.",
            "type": "google_analytics",
            "format": "csv",
            "refreshInterval": 14400,
            "props": {
                "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&dimensions=ga:date,ga:channelGrouping&metrics=ga:sessions&start-date={date.add(-730).format()}&end-date={date.today}&max-results=10000",
                "max_pages": "1",
                "mode": "Simple",
                "profile": "{{ds.google_analytics.profileId}}",
                "timePeriod": "&start-date={date.add(-730).format()}&end-date={date.today}"
            }
        }
    },
    "dsMappings": {
        "googleAnalytics": "7f3c073596c23673ff0ddoogeraspilk"
    },
    "services": [{
        "service": "google_analytics"
    }],
    "datasourceConfigModel": [{
        "type": "select",
        "id": "ds.google_analytics.profileId",
        "label": "Analytics Account",
        "description": "Select an Analytics Account from the drop-down list.",
        "isRequired": true
    }],
    "queries": [{
        "errorMessage": "Here are two suggestions:<br><br>1. Make sure you have access to your company's Google Analytics account. <br><br>2. From time to time, your Google OAuth token will expire. This token allows you to safely bring your data into Klipfolio. <a href='http://klipfolio.uservoice.com/knowledgebase/articles/404228-oauth-token-expired' target='_blank'>Find out how to re-authorize your OAuth tokens</a>.",
        "connector": {
            "service": "google_analytics",
            "type": "simple_rest",
            "format": "json",
            "props": {
                "endpoint_url": "https://www.googleapis.com/analytics/v3/management/accounts/~all/webproperties/~all/profiles?fields=items(id%2Cname%2Cpermissions%2CwebPropertyId%2CwebsiteUrl)",
                "method": "GET"
            }
        },
        "results": [{
            "propId": "ds.google_analytics.profileId",
            "propField": "options",
            "labels": "/items/name",
            "values": "/items/id"
        }]
    }]
}
