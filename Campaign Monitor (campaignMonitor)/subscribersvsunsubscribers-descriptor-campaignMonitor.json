{
    "name" : "Campaign Monitor Subscribers vs Unsubscribers (Last 30 Days)",
    "description" : "Show the subscribers and unsubscribers in your Campaign Monitor for the last 30 days. Originates from the Gallery.",

    "datasources" : {
        "campaignMonitor-01" : {
            "service" : "campaign_monitor",
            "type": "simple_rest",
            "libraryAlias" : "CampaignMonitorLists",
            "name": "Campaign Monitor Lists",
            "description" : "Provide Your Campaign Monitor List",
            "format" : "json",
            "refreshInterval" : 14400,
            "props":{
                "auth_method" : "basic",
                "basic_auth_username" : "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password" : "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/clients/{{ds.campaign_monitor.clientId}}/lists.json",
                "method": "get"
            }
        },
        "campaignMonitor-02" : {
            "service" : "campaign_monitor",
            "type": "simple_rest",
            "libraryAlias" : "CampaignMonitorActiveSubscribersLast30Days",
            "name": "Campaign Monitor Active Subscribers (Last 30 Days)",
            "description" : "Provide the active subscribers in your Campaign Monitor account",
            "format" : "json",
            "refreshInterval" : 14400,
            "props":{
                "auth_method" : "basic",
                "basic_auth_username" : "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password" : "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/lists/{{ds.campaign_monitor.listId}}/active.json?date={date.last30Days.format('yyyy-MM-dd')}&orderfield=date&orderdirection=desc",
                "method": "get"
            }
        },
        "campaignMonitor-03" : {
            "service" : "campaign_monitor",
            "type": "simple_rest",
            "libraryAlias" : "CampaignMonitorUnsubscribersLast30Days",
            "name": "Campaign Monitor Unsubscribers (Last 30 Days)",
            "description" : "Provide the unsubscribers in your Campaign Monitor account",
            "format" : "json",
            "refreshInterval" : 14400,
            "props":{
                "auth_method" : "basic",
                "basic_auth_username" : "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password" : "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/lists/{{ds.campaign_monitor.listId}}/unsubscribed.json?date={date.last30Days.format('yyyy-MM-dd')}&orderfield=date&orderdirection=desc",
                "method": "get"
            }
        }
    },

    "dsMappings" : {
        "campignMonitor-01" : "80c5606234bdbe7f7df5doogeraspilk",
        "campignMonitor-02" : "b9f77fe315ff0ad8373fdoogeraspilk",
        "campignMonitor-03" : "da00e77423c0f905adb8doogeraspilk"
    },

    "services" : [
        {
            "service" : "campaign_monitor"
        }
    ],
    "datasourceConfigModel" : [
        {
            "type" : "select",
            "id" : "ds.campaign_monitor.clientId",
            "label" : "Client Name",
            "description":"Select your Campaign Monitor Client Name.",
            "isRequired" : true,
            "onChangeQueries" : [ "q2" ]
        },
        {
            "type" : "select",
            "id" : "ds.campaign_monitor.listId",
            "label" : "List",
            "description":"Select your Campaign Monitor List Name.",
            "isRequired" : true
        }
    ],
    "queries": [
        {
            "errorMessage":"Make sure you have the correct Campaign Monitor API Key.",
            "connector": {
                "service": "campaign_monitor",
                "type": "simple_rest",
                "format": "json",
                "props": {
                "auth_method" : "basic",
                "basic_auth_username" : "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password" : "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/clients.json"
                }
            },
            "results": [
                {
                    "propId" : "ds.campaign_monitor.clientId",
                    "propField" : "options",
                    "labels": "/Name",
                    "values": "/ClientID"
                }
            ]
        },
        {
            "id": "q2",
            "connector": {
                "service": "campaign_monitor",
                "type": "simple_rest",
                "format": "json",
                "props": {
                "auth_method" : "basic",
                "basic_auth_username" : "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password" : "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/clients/{{ds.campaign_monitor.clientId}}/lists.json"
                }
            },
            "results": [
                {
                    "propId" : "ds.campaign_monitor.listId",
                    "propField" : "options",
                    "labels": "/Name",
                    "values": "/ListID"
                }
            ]
        }
    ]
}