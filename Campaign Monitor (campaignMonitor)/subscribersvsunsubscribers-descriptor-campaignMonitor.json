{
    "name": "Campaign Monitor Subscribers vs Unsubscribers (Last 30 Days)",
    "description": "Compare your email marketing subscribers to unsubscribers over the past 30 days. Originates from the Gallery.",
    "sampleFormulas": {
        "1088efd9-8": {
            "txt": "\"Subscribers\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Subscribers"
                }]
            }
        },
        "c71ef0a1": {
            "txt": "\"977\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "977"
                }]
            }
        },
        "b6f0f492-3": {
            "txt": "array(\"977\",\"12\",\"261\",\"616\",\"714\",\"864\",\"619\",\"980\",\"502\",\"636\",\"441\",\"847\",\"388\",\"691\",\"200\",\"450\",\"224\",\"33\",\"338\",\"283\",\"149\",\"83\",\"884\",\"460\",\"961\",\"114\",\"744\",\"2\",\"198\",\"734\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "977"
                    }, {
                        "t": "l",
                        "v": "12"
                    }, {
                        "t": "l",
                        "v": "261"
                    }, {
                        "t": "l",
                        "v": "616"
                    }, {
                        "t": "l",
                        "v": "714"
                    }, {
                        "t": "l",
                        "v": "864"
                    }, {
                        "t": "l",
                        "v": "619"
                    }, {
                        "t": "l",
                        "v": "980"
                    }, {
                        "t": "l",
                        "v": "502"
                    }, {
                        "t": "l",
                        "v": "636"
                    }, {
                        "t": "l",
                        "v": "441"
                    }, {
                        "t": "l",
                        "v": "847"
                    }, {
                        "t": "l",
                        "v": "388"
                    }, {
                        "t": "l",
                        "v": "691"
                    }, {
                        "t": "l",
                        "v": "200"
                    }, {
                        "t": "l",
                        "v": "450"
                    }, {
                        "t": "l",
                        "v": "224"
                    }, {
                        "t": "l",
                        "v": "33"
                    }, {
                        "t": "l",
                        "v": "338"
                    }, {
                        "t": "l",
                        "v": "283"
                    }, {
                        "t": "l",
                        "v": "149"
                    }, {
                        "t": "l",
                        "v": "83"
                    }, {
                        "t": "l",
                        "v": "884"
                    }, {
                        "t": "l",
                        "v": "460"
                    }, {
                        "t": "l",
                        "v": "961"
                    }, {
                        "t": "l",
                        "v": "114"
                    }, {
                        "t": "l",
                        "v": "744"
                    }, {
                        "t": "l",
                        "v": "2"
                    }, {
                        "t": "l",
                        "v": "198"
                    }, {
                        "t": "l",
                        "v": "734"
                    }]
                }]
            }
        },
        "040d8d2e-4": {
            "txt": "\"0\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "0"
                }]
            }
        },
        "2a875e68-11": {
            "txt": "\"0\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "0"
                }]
            }
        },
        "dde925c6": {
            "txt": "\"Apr 01\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Apr 01"
                }]
            }
        },
        "9e05db38": {
            "txt": "\"Apr 30\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Apr 30"
                }]
            }
        },
        "4b737dfa-9": {
            "txt": "\"Unsubscribers\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Unsubscribers"
                }]
            }
        },
        "3c6991e7-12": {
            "txt": "\"98\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "98"
                }]
            }
        },
        "4f2cb819-6": {
            "txt": "array(\"20\",\"98\",\"32\",\"78\",\"70\",\"67\",\"34\",\"38\",\"90\",\"83\",\"43\",\"82\",\"95\",\"30\",\"44\",\"36\",\"54\",\"61\",\"66\",\"70\",\"79\",\"90\",\"62\",\"33\",\"36\",\"37\",\"83\",\"34\",\"18\",\"62\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "20"
                    }, {
                        "t": "l",
                        "v": "98"
                    }, {
                        "t": "l",
                        "v": "32"
                    }, {
                        "t": "l",
                        "v": "78"
                    }, {
                        "t": "l",
                        "v": "70"
                    }, {
                        "t": "l",
                        "v": "67"
                    }, {
                        "t": "l",
                        "v": "34"
                    }, {
                        "t": "l",
                        "v": "38"
                    }, {
                        "t": "l",
                        "v": "90"
                    }, {
                        "t": "l",
                        "v": "83"
                    }, {
                        "t": "l",
                        "v": "43"
                    }, {
                        "t": "l",
                        "v": "82"
                    }, {
                        "t": "l",
                        "v": "95"
                    }, {
                        "t": "l",
                        "v": "30"
                    }, {
                        "t": "l",
                        "v": "44"
                    }, {
                        "t": "l",
                        "v": "36"
                    }, {
                        "t": "l",
                        "v": "54"
                    }, {
                        "t": "l",
                        "v": "61"
                    }, {
                        "t": "l",
                        "v": "66"
                    }, {
                        "t": "l",
                        "v": "70"
                    }, {
                        "t": "l",
                        "v": "79"
                    }, {
                        "t": "l",
                        "v": "90"
                    }, {
                        "t": "l",
                        "v": "62"
                    }, {
                        "t": "l",
                        "v": "33"
                    }, {
                        "t": "l",
                        "v": "36"
                    }, {
                        "t": "l",
                        "v": "37"
                    }, {
                        "t": "l",
                        "v": "83"
                    }, {
                        "t": "l",
                        "v": "34"
                    }, {
                        "t": "l",
                        "v": "18"
                    }, {
                        "t": "l",
                        "v": "62"
                    }]
                }]
            }
        },
        "7c1801e3-7": {
            "txt": "\"0\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "0"
                }]
            }
        },
        "44b719ef-13": {
            "txt": "\"0\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "0"
                }]
            }
        },
        "b7195f2a": {
            "txt": "\"Apr 01\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Apr 01"
                }]
            }
        },
        "18fbadbf": {
            "txt": "\"Apr 30\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Apr 30"
                }]
            }
        },
        "ef2e7097-3": {
            "txt": "\"Awesome Klips\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Awesome Klips"
                }]
            }
        }
    },

    "datasources": {
        "campaignMonitor-01": {
            "service": "campaign_monitor",
            "type": "simple_rest",
            "libraryAlias": "CampaignMonitorLists",
            "name": "Campaign Monitor Lists",
            "description": "Provide Your Campaign Monitor List",
            "format": "json",
            "refreshInterval": 14400,
            "props": {
                "auth_method": "basic",
                "basic_auth_username": "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password": "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/clients/{{ds.campaign_monitor.clientId}}/lists.json",
                "method": "get"
            }
        },
        "campaignMonitor-02": {
            "service": "campaign_monitor",
            "type": "simple_rest",
            "libraryAlias": "CampaignMonitorActiveSubscribersLast30Days",
            "name": "Campaign Monitor Active Subscribers (Last 30 Days)",
            "description": "Provide the active subscribers in your Campaign Monitor account",
            "format": "json",
            "refreshInterval": 14400,
            "props": {
                "auth_method": "basic",
                "basic_auth_username": "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password": "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/lists/{{ds.campaign_monitor.listId}}/active.json?date={date.last30Days.format('yyyy-MM-dd')}&orderfield=date&orderdirection=desc",
                "method": "get"
            }
        },
        "campaignMonitor-03": {
            "service": "campaign_monitor",
            "type": "simple_rest",
            "libraryAlias": "CampaignMonitorUnsubscribersLast30Days",
            "name": "Campaign Monitor Unsubscribers (Last 30 Days)",
            "description": "Provide the unsubscribers in your Campaign Monitor account",
            "format": "json",
            "refreshInterval": 14400,
            "props": {
                "auth_method": "basic",
                "basic_auth_username": "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password": "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/lists/{{ds.campaign_monitor.listId}}/unsubscribed.json?date={date.last30Days.format('yyyy-MM-dd')}&orderfield=date&orderdirection=desc",
                "method": "get"
            }
        }
    },

    "dsMappings": {
        "campaignMonitor-01": "80c5606234bdbe7f7df5doogeraspilk",
        "campaignMonitor-02": "b9f77fe315ff0ad8373fdoogeraspilk",
        "campaignMonitor-03": "da00e77423c0f905adb8doogeraspilk"
    },

    "services": [{
        "service": "campaign_monitor"
    }],
    "datasourceConfigModel": [{
        "type": "select",
        "id": "ds.campaign_monitor.clientId",
        "label": "Client Name",
        "description": "Select your Campaign Monitor Client Name.",
        "isRequired": true,
        "onChangeQueries": ["q2"]
    }, {
        "type": "select",
        "id": "ds.campaign_monitor.listId",
        "label": "List",
        "description": "Select your Campaign Monitor List Name.",
        "isRequired": true
    }],
    "queries": [{
        "errorMessage": "Make sure you have the correct Campaign Monitor API Key. Check out <a href='http://klipfolio.uservoice.com/knowledgebase/articles/809415-klip-gallery-campaign-monitor#connect' target='_blank'>Klip Gallery: Campaign Monitor</a> for more information.",
        "connector": {
            "service": "campaign_monitor",
            "type": "simple_rest",
            "format": "json",
            "props": {
                "auth_method": "basic",
                "basic_auth_username": "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password": "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/clients.json"
            }
        },
        "results": [{
            "propId": "ds.campaign_monitor.clientId",
            "propField": "options",
            "labels": "/Name",
            "values": "/ClientID"
        }]
    }, {
        "id": "q2",
        "connector": {
            "service": "campaign_monitor",
            "type": "simple_rest",
            "format": "json",
            "props": {
                "auth_method": "basic",
                "basic_auth_username": "{{auth.campaign_monitor.apiKey}}",
                "basic_auth_password": "x",
                "endpoint_url": "https://api.createsend.com/api/v3.1/clients/{{ds.campaign_monitor.clientId}}/lists.json"
            }
        },
        "results": [{
            "propId": "ds.campaign_monitor.listId",
            "propField": "options",
            "labels": "/Name",
            "values": "/ListID"
        }]
    }]
}
