{
    "name" : "Time Spent in Meetings (Previous Week)",
    "description" : "Monitor the time spent in meetings based on your Google Calendar. Originates from the Gallery.",

    "datasources" : {
        "googleCalendar" : {
            "service" : "google_calendar",
            "type" : "simple_rest",
            "format" : "json",
            "name" :"Google Calendar Events (Previous Week)",
            "libraryAlias" :"GoogleCalendarEventsPreviousWeek",
            "refreshInterval" : 14400,
            "description" :"Retrieves last week's events for a specified Google Calendar ID. Originates from the Gallery.",
            "props":{
                "endpoint_url": "https://www.googleapis.com/calendar/v3/calendars/{{ds.google_calendar.calendarID}}/events?timeMin={date.addWeeks(-1).startOfWeek.format(\"yyyy-MM-dd'T'HH:mm:ss.SSZ\")}&timeMax={date.addWeeks(-1).endOfWeek.format(\"yyyy-MM-dd'T'HH:mm:ss.SSZ\")}&singleEvents=true&orderBy=startTime",
                "method": "get"
            }
        }
    },

    "dsMappings": {
        "googleCalendar" : "d3608049f824bdadf24dnatceewzhere"
    },

    "services" : [
        {
            "service" : "google_calendar"
        }
    ],

    "uiVariables": [
        {
            "name":"KTWeeklyWorkHours", 
            "value":"37.5" 
        }
    ],

    "datasourceConfigModel" : [
        {
            "type" : "select",
            "id" : "ds.google_calendar.calendarID",
            "label" : "Calendar",
            "description" :"Select a calendar from the list below.",
            "isRequired" : true
        }
    ],
    "queries": [
        {   
            "errorMessage":"From time to time, your Google OAuth token will expire. This token allows you to safely bring your data into Klipfolio. <a href='http://klipfolio.uservoice.com/knowledgebase/articles/404228-oauth-token-expired' target='_blank'>Find out how to re-authorize your OAuth tokens</a>.",
            "connector": {
                "service": "google_calendar",
                "type": "simple_rest",
                "format": "json",
                "props": {
                    "endpoint_url": "https://www.googleapis.com/calendar/v3/users/me/calendarList",
                    "method": "GET"
                }
            },
            "results": [
                { 
                    "propId" : "ds.google_calendar.calendarID",
                    "propField" : "options", 
                    "labels": "/items/id[not(contains(.,'#'))]/following-sibling::summary",  
                    "values": "/items/id[not(contains(.,'#'))]"
                }
            ]
        }
    ]
}