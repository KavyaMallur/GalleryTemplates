{
    "name" : "Pingdom & Google Analytics: Sessions vs Response Time",
    "description": "Compare your website sessions and response time using Pingdom and Google Analytics. Originates from the Gallery.",

    "datasources" : {
        "pingdom-01" : {
            "service" : "pingdom",
            "type" : "simple_rest",
            "format" : "json",
            "name" :"Pingdom Service Checks",
            "libraryAlias" :"pingdomServiceChecks",
            "refreshInterval" : 3600,
            "description" :"See an overview of all Pingdom checks. Originates from the Gallery.",
            "props":{
                "endpoint_url" : "https://api.pingdom.com/api/2.0/checks",
                "method" : "GET",
                "auth_method" : "basic",
                "parameters" : "[{\"name\":\"App-Key\",\"value\":\"inab7669wia1jffg80gn28fkczmc9r2y\",\"type\":\"header\"}]"
            }
        },

        "pingdom-02" : {
            "service" : "pingdom",
            "type" : "simple_rest",
            "format" : "json",
            "name" :"Pingdom Average Response Time (Last 24 hours)",
            "libraryAlias" :"PingdomAverageResponseTimeLast24Hours",
            "refreshInterval" : 3600,
            "description" :"Provides the average response time for your specified server over the last 24 hours. Originates from the Gallery.",
            "props":{
                "endpoint_url" : "https://api.pingdom.com/api/2.0/summary.performance/{{ds.pingdom.serverId}}?resolution=hour&from={date.addHours(-24).format('epochTime')}&to={date.addHours(-1).format('epochTime')}",
                "method" : "GET",
                "auth_method" : "basic",
                "parameters" : "[{\"name\":\"App-Key\",\"value\":\"inab7669wia1jffg80gn28fkczmc9r2y\",\"type\":\"header\"}]"
            }
        },

        "google_analytics-01" : {
            "service" : "google_analytics",
            "type" : "google_analytics",
            "format" : "csv",
            "name" :"GA Site Speed Stats (Last 24 hours)",
            "libraryAlias" :"GASiteSpeedStatsLast24Hours",
            "refreshInterval" : 3600,
            "description" :"Provides google analytics site speed stats over last 24 hours. Originates from the Gallery.",
            "props":{
                "endpoint_url" : "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&dimensions=ga:date,ga:hour&metrics=ga:sessions,ga:avgPageLoadTime,ga:avgRedirectionTime,ga:avgServerResponseTime&start-date={date.yesterday}&end-date={date.today}&max-results=10000",
                "max_pages": "1",
                "mode": "Advanced"
            }

        }
    },

    "dsMappings": {
        "pingdom-01" : "b4fe50b45c834d192174KavyaMallur9",
        "pingdom-02" : "bc45bc2429076c589a02KavyaMallur9",
        "google_analytics-01" : "f1115f5d0c6c8a76440dKavyaMallur9"
    },

    "services" : [
        {
            "service" : "pingdom"
        },
        {
            "service" : "google_analytics"
        }
    ],

    "datasourceConfigModel" : [
        {
            "type" : "select",
            "id" : "ds.pingdom.serverId",
            "label" : "Pingdom Check",
            "isRequired" : true,
            "onChangeQueries" : [ "meow2" ]      

        },
        {
            "type" : "select",
            "id" : "ds.google_analytics.profileId",
            "label" : "Google Analytics Profile",
            "isRequired" : true
        },
        {
            "type": "select",
            "id": "ds.pingdom.timeZone",
            "label": "Time Zone",
            "options": [
                {"value":"GMT-1","label":"GMT-01:00 (Cape Verde Standard Time)"},
                {"value":"GMT-2","label":"GMT-02:00 (Mid-Atlantic Standard Time)"},
                {"value":"GMT-3","label":"GMT-03:00 (Greenland Standard Time)"},
                {"value":"GMT-3:30","label":"GMT-03:30 (Newfoundland Standard Time)"},
                {"value":"GMT-4","label":"GMT-04:00 (Atlantic Standard Time)"},
                {"value":"GMT-4:30","label":"GMT-04:30 (Venezuela Standard Time)"},
                {"value":"GMT-5","label":"GMT-05:00 (Eastern Standard Time)"},
                {"value":"GMT-6","label":"GMT-06:00 (Central Standard Time)"},
                {"value":"GMT-7","label":"GMT-07:00 (Mountain Standard Time)"},
                {"value":"GMT-8","label":"GMT-08:00 (Pacific Standard Time)"},
                {"value":"GMT-9","label":"GMT-09:00 (Alaskan Standard Time)"},
                {"value":"GMT-10","label":"GMT-10:00 (Hawaiian Standard Time)"},
                {"value":"GMT-11","label":"GMT-11:00 (Samoa Standard Time)"},
                {"value":"GMT-12","label":"GMT-12:00 (Dateline Standard Time)"},
                {"value":"GMT","label":"GMT (Greenwich Standard Time)"},
                {"value":"GMT+1","label":"GMT+01:00 (Central European Standard Time)"},
                {"value":"GMT+2","label":"GMT+02:00 (E. Europe Standard Time)"},
                {"value":"GMT+3","label":"GMT+03:00 (Georgian Standard Time)"},
                {"value":"GMT+3:30","label":"GMT+03:30 (Iran Standard Time)"},
                {"value":"GMT+4","label":"GMT+04:00 (Arabian Standard Time)"},
                {"value":"GMT4+30","label":"GMT+04:30 (Afghanistan Standard Time)"},
                {"value":"GMT+5","label":"GMT+05:00 (West Asia Standard Time)"},
                {"value":"GMT+5:30","label":"GMT+05:30 (India Standard Time)"},
                {"value":"GMT+5:45","label":"GMT+05:45 (Nepal Standard Time)"},
                {"value":"GMT+6","label":"GMT+06:00 (Central Asia Standard Time)"},
                {"value":"GMT+6:30","label":"GMT+06:30 (Myanmar Standard Time)"},
                {"value":"GMT+7","label":"GMT+07:00 (SE Asia Standard Time)"},
                {"value":"GMT+8","label":"GMT+08:00 (China Standard Time)"},
                {"value":"GMT+9","label":"GMT+09:00 (Tokyo Standard Time)"},
                {"value":"GMT+9:30","label": "GMT+09:30 (Cen. Australia Standard Time)"},
                {"value":"GMT+10","label":"GMT+10:00 (West Pacific Standard Time)"},
                {"value":"GMT+11","label":"GMT+11:00 (Central Pacific Standard Time)"},
                {"value":"GMT+12","label":"GMT+12:00 (Fiji Standard Time)"},
                {"value":"GMT+13","label":"GMT+13:00 (Tonga Standard Time)"}
            ],
            "isRequired" : "true",
            "selectedValue": "GMT"
        }
    ],
    "queries": [
        {
            "errorMessage":"Check your Pingdom credentials and try again.",
            "connector": {
                "service": "pingdom",
                "type": "simple_rest",
                "format": "json",
                "props": {
                    "endpoint_url": "https://api.pingdom.com/api/2.0/checks",
                    "method": "GET",
                    "auth_method": "basic",
                    "parameters": "[{\"name\":\"App-Key\",\"value\":\"inab7669wia1jffg80gn28fkczmc9r2y\",\"type\":\"header\"}]"
                }
            },
            "results": [
                {
                    "propId" : "ds.pingdom.serverId", 
                    "propField" : "options", 
                    "labels": "/checks/name",  
                    "values": "/checks/id" 
                }
            ]
        },
        {
            "id":"meow2",
            "errorMessage":"There are two possible reasons: <br><br>1. Your Google Analytics OAuth token has expired. <a href='http://klipfolio.uservoice.com/knowledgebase/articles/404228-oauth-token-expired' target='_blank'>How do I re-authorize my OAuth token?</a> <br><br>2. You don't have access to a Google Analytics account. Ask an administrator to grant you access.",
            "connector": {
                "service": "google_analytics",
                "type": "simple_rest",
                "format": "json",
                "props": {
                    "endpoint_url": "https://www.googleapis.com/analytics/v3/management/accounts/~all/webproperties/~all/profiles?fields=items(id%2Cname%2Cpermissions%2CwebPropertyId%2CwebsiteUrl)",
                    "method": "GET"
                }
            },
            "results": [
                { 
                    "propId" : "ds.google_analytics.profileId",
                    "propField" : "options", 
                    "labels": "/items/name",  
                    "values": "/items/id" 
                }
            ]
        }        
   
    ]
}