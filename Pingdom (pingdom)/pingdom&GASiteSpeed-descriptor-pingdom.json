{
    "name" : "Pingdom & Google Analytics: Site Speed",
    "description": "Compare the site speed of pingdom against that of google analytics. Originates from the Gallery.",

    "datasources" : {
        "pingdom-01" : {
            "service" : "pingdom",
            "type" : "simple_rest",
            "format" : "json",
            "name" :"Pingdom Server Summary Status (Last 30 Days)",
            "libraryAlias" :"pingdomServerSummaryStatusLast30Daysv2",
            "refreshInterval" : 3600,
            "description" :"Provides high level server statistics over the past 30 days. Originates from the Gallery.",
            "props":{
                "endpoint_url" : "https://api.pingdom.com/api/2.0/summary.average/{{ds.pingdom.serverId}}?from={date.last30Days.format('epochTime')}",
                "method" : "GET",
                "auth_method" : "basic",
                "parameters" : "[{\"name\":\"App-Key\",\"value\":\"inab7669wia1jffg80gn28fkczmc9r2y\",\"type\":\"header\"},{\"name\":\"includeuptime\",\"value\":\"true\",\"type\":\"query\"}]"
            }
        },        
        "pingdom-02" : {
            "service" : "pingdom",
            "type" : "simple_rest",
            "format" : "json",
            "name" :"Pingdom Server Summary Status (31-60 Days Ago)",
            "libraryAlias" :"pingdomServerSummaryStatus3160DaysAgov2",
            "refreshInterval" : 3600,
            "description" :"Provides high level server statistics for 31-60 days ago. Can be used for comparison. Originates from the Gallery.",
            "props":{
                "endpoint_url" : "https://api.pingdom.com/api/2.0/summary.average/{{ds.pingdom.serverId}}?from={date.add(-60).format('epochTime')}&to={date.add(-31).format('epochTime')}",
                "method" : "GET",
                "auth_method" : "basic",
                "parameters" : "[{\"name\":\"App-Key\",\"value\":\"inab7669wia1jffg80gn28fkczmc9r2y\",\"type\":\"header\"},{\"name\":\"includeuptime\",\"value\":\"true\",\"type\":\"query\"}]"
            }
        },
        "google_analytics-01" : {
            "service" : "google_analytics",
            "type" : "google_analytics",
            "format" : "csv",
            "name" :"GA Site Speed Stats (Last 60 Days)",
            "libraryAlias" :"GASiteSpeedStatsLast60Days",
            "refreshInterval" : 3600,
            "description" :"Provides google analytics for last 60 days. Can be used for comparison. Originates from the Gallery.",
            "props" : {
                 "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&dimensions=ga:date&metrics=ga:pageviews,ga:avgPageLoadTime,ga:avgRedirectionTime,ga:avgServerResponseTime&start-date={date.add(-60).format()}&end-date={date.today}&max-results=10000",
                 "max_pages": "1",
                 "mode": "Simple",
                 "profile": "{{ds.google_analytics.profileId}}",
                 "timePeriod": "&start-date={date.add(-60).format()}&end-date={date.today}"
            }
        },
        "pingdom-04" : {
            "service" : "pingdom",
            "type" : "simple_rest",
            "format" : "json",
            "name" :"Pingdom Average Response Time (Last 30 Days)",
            "libraryAlias" :"PingdomAverageResponseTimeLast30Days",
            "refreshInterval" : 3600,
            "description" :"Provides server's average responste time on a daily basis for the last 30 days. Originates from the Gallery.",
            "props":{
                "endpoint_url" : "https://api.pingdom.com/api/2.0/summary.performance/{{ds.pingdom.serverId}}?resolution=day&from={date.last30Days.format('epochTime')}",
                "method" : "GET",
                "auth_method" : "basic",
                "parameters" : "[{\"name\":\"App-Key\",\"value\":\"inab7669wia1jffg80gn28fkczmc9r2y\",\"type\":\"header\"}]"
            }
        }
    },

	"datasourceConfigModel" : [
		{
			"type" : "select",
			"id" : "ds.pingdom.serverId",
            "label" : "Pingdom Check",
            "description": "Choose the Pingdom Check you'd like to monitor.",          
			"isRequired" : true,
            "onChangeQueries" : [ "meow1" ]      
		},
        {
            "type" : "select",
            "id" : "ds.google_analytics.profileId",
            "label" : "Google Analytics Profile",
            "description" : "Select the Google Analytics profile you'd like to monitor.",
            "isRequired" : true
        }
	],	

    "dsMappings": {
        "pingdom-01" : "639abbccaa4e2d870f70KavyaMallur9",
		"pingdom-02" : "3ac202b3d931a2d373d3KavyaMallur9",
        "google_analytics-01" : "e172dcc230b35e273facKavyaMallur9",
        "pingdom-04" : "25606ba6eb6016826497KavyaMallur9"
    },

    "services" : [
        {
            "service" : "pingdom"
        },
        {
            "service" : "google_analytics"
        }
    ],
    "queries": [
        {
            "errorMessage":"There seems to be a problem accessing your Pingdom data. Check your credentials and try again.",
            "connector": {
                "service": "pingdom",
                "errorMessage":"There seems to be a problem accessing your Pingdom data. Check your credentials and try again.",
                "type": "simple_rest",
                "format": "json",
                "props": {
                    "endpoint_url": "https://api.pingdom.com/api/2.0/checks",
                    "method": "GET",
                    "auth_method": "basic",
                    "parameters": "[{\"name\":\"App-Key\",\"value\":\"inab7669wia1jffg80gn28fkczmc9r2y\",\"type\":\"header\"}]"
                }
            },
            "results": [
                {
                    "propId" : "ds.pingdom.serverId", 
                    "propField" : "options", 
                    "labels": "/checks/name",  
                    "values": "/checks/id" 
                }
            ]
        },
        {
            "id":"meow1",
            "errorMessage":"The Google Analytics account you've selected doesn't have access to the required data. <br><br>Make sure your token hasn't expired and that your Google account has access to Google Analytics.",
            "connector": {
                "service": "google_analytics",
                "type": "simple_rest",
                "format": "json",
                "props": {
                    "endpoint_url": "https://www.googleapis.com/analytics/v3/management/accounts/~all/webproperties/~all/profiles?fields=items(id%2Cname%2Cpermissions%2CwebPropertyId%2CwebsiteUrl)",
                    "method": "GET"
                }
            },
            "results": [
                { 
                    "propId" : "ds.google_analytics.profileId",
                    "propField" : "options", 
                    "labels": "/items/name",  
                    "values": "/items/id" 
                }
            ]
        }        
   
    ]
}