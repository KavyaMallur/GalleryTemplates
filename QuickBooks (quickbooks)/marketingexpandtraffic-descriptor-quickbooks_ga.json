{
    "name": "QuickBooks & Google Analytics: Marketing Expenses and Traffic (Last 30 Days)",
    "description": "Mash up your QuickBooks and Google Analytics data to see how your marketing expenses affect your website traffic within the last 30 days. Originates from the Gallery.",

    "sampleFormulas": {
        "3311846a-1": {
            "txt": "\" https://static.klipfolio.com/static/klips/saas/templates/badges/quickbooks.png\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": " https://static.klipfolio.com/static/klips/saas/templates/badges/quickbooks.png"
                }]
            }
        },
        "ac62c1fb": {
            "txt": "\"Advertising & Promotion\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Advertising & Promotion"
                }]
            }
        },
        "d7235771-7": {
            "txt": "\"16838.53\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": 16838.53
                }]
            }
        },
        "bfc933eb-2": {
            "txt": "array(\"180\",\"270\",\"360\",\"1336.1399999999999\",\"720\",\"630\",\"630\",\"720\",\"450\",\"720\",\"360\",\"1432.81\",\"1955.2\",\"360\",\"450\",\"360\",\"1220.5900000000001\",\"2061.8\",\"630\",\"720\",\"810\",\"540\",\"1080\",\"990\",\"540\",\"1400.5900000000001\",\"720\",\"2166.4\",\"450\",\"540\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": 180
                    }, {
                        "t": "l",
                        "v": 270
                    }, {
                        "t": "l",
                        "v": 360
                    }, {
                        "t": "l",
                        "v": 1336.1399999999999
                    }, {
                        "t": "l",
                        "v": 720
                    }, {
                        "t": "l",
                        "v": 630
                    }, {
                        "t": "l",
                        "v": 630
                    }, {
                        "t": "l",
                        "v": 720
                    }, {
                        "t": "l",
                        "v": 450
                    }, {
                        "t": "l",
                        "v": 720
                    }, {
                        "t": "l",
                        "v": 360
                    }, {
                        "t": "l",
                        "v": 1432.81
                    }, {
                        "t": "l",
                        "v": 1955.2
                    }, {
                        "t": "l",
                        "v": 360
                    }, {
                        "t": "l",
                        "v": 450
                    }, {
                        "t": "l",
                        "v": 360
                    }, {
                        "t": "l",
                        "v": 1220.5900000000001
                    }, {
                        "t": "l",
                        "v": 2061.8
                    }, {
                        "t": "l",
                        "v": 630
                    }, {
                        "t": "l",
                        "v": 720
                    }, {
                        "t": "l",
                        "v": 810
                    }, {
                        "t": "l",
                        "v": 540
                    }, {
                        "t": "l",
                        "v": 1080
                    }, {
                        "t": "l",
                        "v": 990
                    }, {
                        "t": "l",
                        "v": 540
                    }, {
                        "t": "l",
                        "v": 1400.5900000000001
                    }, {
                        "t": "l",
                        "v": 720
                    }, {
                        "t": "l",
                        "v": 2166.4
                    }, {
                        "t": "l",
                        "v": 450
                    }, {
                        "t": "l",
                        "v": 540
                    }]
                }]
            }
        },
        "784601da-3": {
            "txt": "\"0\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": 0
                }]
            }
        },
        "f38d9f31-2": {
            "txt": "\"0.11746334911235535580775746211656951345503330230712890625\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "0.11746334911235535580775746211656951345503330230712890625"
                }]
            }
        },
        "0d419d82-3": {
            "txt": "\"15068.529999999999\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": 15068.529999999999
                }]
            }
        },
        "4e03108d": {
            "txt": "\"https://static.klipfolio.com/static/klips/saas/templates/badges/google-analytics.png\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "https://static.klipfolio.com/static/klips/saas/templates/badges/google-analytics.png"
                }]
            }
        },
        "088e3476-7": {
            "txt": "\"Session Traffic\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "Session Traffic"
                }]
            }
        },
        "aaedd6f1-8": {
            "txt": "\"280430\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": 280430
                }]
            }
        },
        "62569115-2": {
            "txt": "array(\"16618.35\",\"19496.28\",\"34531.93\",\"36124.32\",\"35620.44\",\"33873.01\",\"27706.94\",\"19244.34\",\"22571.24\",\"33601.69\",\"33743.81\",\"35081.03\",\"35468.63\",\"29628.79\",\"19124.829999999998\",\"22454.96\",\"35991.89\",\"36282.59\",\"38210.9\",\"36499\",\"30449.21\",\"21450.43\",\"19224.96\",\"36502.23\",\"34951.83\",\"34073.27\",\"29761.22\",\"25345.81\",\"18026.63\",\"21770.2\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": 16618.35
                    }, {
                        "t": "l",
                        "v": 19496.28
                    }, {
                        "t": "l",
                        "v": 34531.93
                    }, {
                        "t": "l",
                        "v": 36124.32
                    }, {
                        "t": "l",
                        "v": 35620.44
                    }, {
                        "t": "l",
                        "v": 33873.01
                    }, {
                        "t": "l",
                        "v": 27706.94
                    }, {
                        "t": "l",
                        "v": 19244.34
                    }, {
                        "t": "l",
                        "v": 22571.24
                    }, {
                        "t": "l",
                        "v": 33601.69
                    }, {
                        "t": "l",
                        "v": 33743.81
                    }, {
                        "t": "l",
                        "v": 35081.03
                    }, {
                        "t": "l",
                        "v": 35468.63
                    }, {
                        "t": "l",
                        "v": 29628.79
                    }, {
                        "t": "l",
                        "v": 19124.829999999998
                    }, {
                        "t": "l",
                        "v": 22454.96
                    }, {
                        "t": "l",
                        "v": 35991.89
                    }, {
                        "t": "l",
                        "v": 36282.59
                    }, {
                        "t": "l",
                        "v": 38210.9
                    }, {
                        "t": "l",
                        "v": 36499
                    }, {
                        "t": "l",
                        "v": 30449.21
                    }, {
                        "t": "l",
                        "v": 21450.43
                    }, {
                        "t": "l",
                        "v": 19224.96
                    }, {
                        "t": "l",
                        "v": 36502.23
                    }, {
                        "t": "l",
                        "v": 34951.83
                    }, {
                        "t": "l",
                        "v": 34073.27
                    }, {
                        "t": "l",
                        "v": 29761.22
                    }, {
                        "t": "l",
                        "v": 25345.81
                    }, {
                        "t": "l",
                        "v": 18026.63
                    }, {
                        "t": "l",
                        "v": 21770.2
                    }]
                }]
            }
        },
        "1385aa12-3": {
            "txt": "\"648\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": 648
                }]
            }
        },
        "3a61159a": {
            "txt": "\"0.294418164966193607323674541476066224277019500732421875\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": "0.294418164966193607323674541476066224277019500732421875"
                }]
            }
        },
        "3ebf4194": {
            "txt": "\"216645.6\"",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "l",
                    "v": 216645.6
                }]
            }
        }
    },
    "datasources": {
        "quickbooks-01": {
            "service": "quickbooks",
            "type": "quickbooks",
            "name": "Quickbooks Profit and Loss (Last 30 Days)",
            "libraryAlias": "QuickbooksProfitAndLoss(Last30Days)",
            "description": "  ",
            "format": "json",
            "refreshInterval": 14400,
            "props": {
                "endpoint_url": "https://quickbooks.api.intuit.com/v3/company/{{ds.quickbooks.companyID}}/reports/ProfitAndLoss?minorversion=5&start_date={date.add(-30).format('yyyy-MM-dd')}&end_date={date.add(-1).format('yyyy-MM-dd')}&summarize_column_by=Days"
            }
        },
        "quickbooks-02": {
            "service": "quickbooks",
            "type": "quickbooks",
            "name": "Quickbooks Profit and Loss (Prev 30 Days)",
            "libraryAlias": "QuickbooksProfitAndLoss(Prev30Days)",
            "description": "  ",
            "format": "json",
            "refreshInterval": 14400,
            "props": {
                "endpoint_url": "https://quickbooks.api.intuit.com/v3/company/{{ds.quickbooks.companyID}}/reports/ProfitAndLoss?minorversion=5&start_date={date.add(-60).format('yyyy-MM-dd')}&end_date={date.add(-31).format('yyyy-MM-dd')}&summarize_column_by=Days"
            }
        },
        "googleAnalytics": {
            "service": "google_analytics",
            "libraryAlias": "GoogleAnalyticsChannelDefaultGroupingLast60Days",
            "name": "Google Analytics Channel Default Grouping (Last 60 Days)",
            "description": "Shows the number of sessions by day, broken down by traffic channels for the last 730 days to date. Originates from the Gallery.",
            "type": "google_analytics",
            "format": "csv",
            "refreshInterval": 14400,
            "props": {
                "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&dimensions=ga:channelGrouping,ga:date&metrics=ga:sessions&start-date={date.add(-60).format()}&end-date={date.today}&max-results=10000",
                "advancedQuery": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&dimensions=ga:channelGrouping,ga:date&metrics=ga:sessions&start-date={date.add(-60).format()}&end-date={date.today}&max-results=10000",
                "max_pages": "1",
                "mode": "Advanced",
                "profile": "{{ds.google_analytics.profileId}}",
                "timePeriod": "&start-date={date.add(-60).format()}&end-date={date.today}"
            }
        }
    },

    "dsMappings": {
        "quickbooks-01": "af02ff08d70da8afe008doogeraspilk",
        "quickbooks-02": "46657a0a25e76e967252doogeraspilk",
        "googleAnalytics": "6ac27af467a44a97f3c4doogeraspilk"

    },

    "services": [{
        "service": "quickbooks"
    }, {
        "service": "google_analytics"
    }],

    "datasourceConfigModel": [{
        "type": "text",
        "id": "ds.quickbooks.companyID",
        "description": "Enter your QuickBooks Company ID. Need help? See <a href='https://support.klipfolio.com/hc/en-us/articles/216838197#connect' target='_blank'>Klip Gallery: QuickBooks</a>.",
        "label": "Company ID",
        "ghostText": "12345678910",
        "isRequired": true,
        "debounceEnabled": true,
        "onChangeQueries": ["q1"]
    }, {
        "type": "select",
        "id": "ds.quickbooks.expenseName",
        "label": "Name of Expense",
        "description": "Please select the name of your marketing expense.",
        "isRequired": true,
        "onChangeQueries": ["q2"]
    }, {
        "type": "select",
        "id": "ds.google_analytics.profileId",
        "label": "Analytics Account",
        "description": "Select an Analytics Account from the drop-down list.",
        "isRequired": true
    }],
    "queries": [{
        "id": "q1",
        "errorMessage": "Here are some possible reasons:<br><br> - Make sure you have the correct <a href='https://support.klipfolio.com/hc/en-us/articles/216838197# connect' target='_blank'>Quickbooks company ID</a>. <br> <br> Every time you log into your account while adding a Klip, you are creating a new OAuth token:<br> <br> - Select the newest token for each service (old tokens become invalid when new ones are created). <br> - From time to time, your OAuth tokens will expire. <a href='https://support.klipfolio.com/hc/en-us/articles/215548958-OAuth-token-expired-for-connected-accounts' target='_blank'> Find out how to re-authorize your OAuth tokens </a>.",
        "connector": {
            "service": "quickbooks",
            "type": "quickbooks",
            "format": "json",
            "props": {
                "endpoint_url": "https://quickbooks.api.intuit.com/v3/company/{{ds.quickbooks.companyID}}/reports/ProfitAndLoss?minorversion=5&start_date={date.add(-30).format('yyyy-MM-dd')}&end_date={date.add(-1).format('yyyy-MM-dd')}&summarize_column_by=Days"
            }
        },
        "results": [{
            "propId": "ds.quickbooks.expenseName",
            "propField": "options",
            "labels": "//Rows[preceding-sibling::Header//value='Expenses']/Row/ColData[1]/value | //Rows[preceding-sibling::Header//value='Expenses']//Summary/ColData[1]/value",
            "values": "//Rows[preceding-sibling::Header//value='Expenses']/Row/ColData[1]/value | //Rows[preceding-sibling::Header//value='Expenses']//Summary/ColData[1]/value"
        }]
    }, {
        "id": "q2",
        "errorMessage": "Here are two suggestions:<br><br>1. Make sure you have access to your company's Google Analytics account. <br><br>2. From time to time, your Google OAuth token will expire. This token allows you to safely bring your data into Klipfolio. <a href='https://support.klipfolio.com/hc/en-us/articles/215548958-OAuth-token-expired-for-connected-accounts' target='_blank'>Find out how to re-authorize your OAuth tokens</a>.",
        "connector": {
            "service": "google_analytics",
            "type": "simple_rest",
            "format": "json",
            "props": {
                "endpoint_url": "https://www.googleapis.com/analytics/v3/management/accounts/~all/webproperties/~all/profiles?fields=items(id%2Cname%2Cpermissions%2CwebPropertyId%2CwebsiteUrl)",
                "method": "GET"
            }
        },
        "results": [{
            "propId": "ds.google_analytics.profileId",
            "propField": "options",
            "labels": "/items/name",
            "values": "/items/id"
        }]
    }]
}