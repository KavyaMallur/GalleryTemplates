{
    "name": "Campaign Performance for ds.google_analytics.campaignName",
    "description": "See how your campaigns are performing for the selected date range. Originates from the Gallery.",

    "datasources": {
        "facebookAds-01": {
            "service": "facebook_ads",
            "libraryAlias": "FacebooksAdsCampaignAdsetsBudget",
            "name": "Facebooks Ads Campaign Adsets Budgets",
            "description": "Retrieve the budget details of the Adsets in a Facebook Ads Campaign. Originates from the Gallery.",
            "type": "facebook",
            "format": "json",
            "refreshInterval": 14400,
            "props": {
                "endpoint_url": "https://graph.facebook.com/v2.6/{{ds.facebook_ads.campaignId}}/adsets?fields=id,name,lifetime_budget,daily_budget,budget_remaining",
                "graphUrl": "https://graph.facebook.com/v2.6/{{ds.facebook_ads.campaignId}/adsets?fields=id,name,lifetime_budget,daily_budget,budget_remaining",
                "qtype": "Graph API"
            }
        },
        "facebookAds-02": {
            "service": "facebook_ads",
            "libraryAlias": "FacebooksAdsCampaignMetrics",
            "name": "Facebooks Ads Campaign Metrics",
            "description": "Retrieve the daily metrics of a Facebook Ads Campaign for the last 90 days. Originates from the Gallery.",
            "type": "facebook",
            "format": "json",
            "refreshInterval": 14400,
            "props": {
                "endpoint_url": "https://graph.facebook.com/v2.6/{{ds.facebook_ads.campaignId}}/insights?date_preset=last_90_days&time_increment=1&fields=spend,actions,ctr,clicks,impressions&limit=100",
                "graphUrl": "https://graph.facebook.com/v2.6/{{ds.facebook_ads.campaignId}}/insights?date_preset=last_90_days&time_increment=1&fields=spend,actions,ctr,clicks,impressions&limit=100",
                "qtype": "Graph API"
            }
        },
        "googleAnalytics": {
            "service": "google_analytics",
            "libraryAlias": "GoogleAnalyticsCampaignMetrics",
            "name": "Google Analytics Campaign Metrics (Trial-Facebook-Marketers)",
            "description": "Retrieve detailed Google AdWords metrics on your website's keyword performance through Google Analytics. Originates from the Gallery.",
            "type": "google_analytics",
            "format": "csv",
            "refreshInterval": 14400,
            "props": {
                "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&dimensions=ga:campaign,ga:date&metrics=ga:sessions,ga:bounces,ga:pageviews,ga:newusers,ga:bounceRate,ga:pageviewsPerSession,ga:sessionDuration,ga:ctr,ga:adClicks,ga:impressions&start-date={date.add(-90).format()}&end-date={date.today}&filters=ga:campaign=={{ds.google_analytics.campaignName}}",
                "advancedQuery": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&dimensions=ga:campaign,ga:date&metrics=ga:sessions,ga:bounces,ga:pageviews,ga:newusers,ga:bounceRate,ga:pageviewsPerSession,ga:sessionDuration,ga:ctr,ga:adClicks,ga:impressions&start-date={date.add(-90).format()}&end-date={date.today}&filters=ga:campaign=={{ds.google_analytics.campaignName}}",
                "max_pages": "1",
                "mode": "Advanced",
                "profile": "{{ds.google_analytics.profileId}}",
                "timePeriod": "&start-date={date.add(-30).format()}&end-date={date.yesterday}"
            }
        }
    },
    "services": [{
        "service": "facebook_ads"
    }, {
        "service": "google_analytics"
    }],
    "dsMappings": {
        "facebookAds-01": "4481689ae9348edba658doogeraspilk",
        "facebookAds-02": "c5832bb29501bb14ae5fdoogeraspilk",
        "googleAnalytics": "3fe095cc3418f297e5dadoogeraspilk"
    },
    "uiVariables": [{
        "name": "fbAdsPeriod",
        "value": "last7days"
    },{
        "name": "fbAdsConversionTarget",
        "value": "100"
    },{
        "name": "fbAdsCPCTarget",
        "value": "10"
    }],
    "datasourceConfigModel": [{
        "type": "select",
        "id": "ds.facebook_ads.accountId",
        "label": "Account",
        "description": "Select a Facebook Ads Account and Campaign Name",
        "isRequired": true,
        "onChangeQueries": ["q2"]
    }, {
        "type": "select",
        "id": "ds.facebook_ads.campaignId",
        "label": "Campaign",
        "isRequired": true,
        "onChangeQueries": ["q3"]
    }, {
        "type": "select",
        "id": "ds.google_analytics.profileId",
        "label": "Profile",
        "description": "Select a Google Analytics Profile and Campaign Name",
        "isRequired": true,
        "onChangeQueries": ["q4"]
    }, {
        "type": "select",
        "id": "ds.google_analytics.campaignName",
        "label": "Campaign",
        "urlEncode": true,
        "isRequired": true
    }],
    "queries": [{
        "errorMessage": "Here are two suggestions:<br><br>1. Make sure the Facebook account you signed in with includes a Facebook Ads account. <br><br>2. From time to time, your Facebook OAuth token will expire. This token allows you to safely bring your data into Klipfolio. <a href='https://support.klipfolio.com/hc/en-us/articles/215548958-OAuth-token-expired-for-connected-accounts' target='_blank'>Find out how to re-authorize your OAuth tokens</a>.",
        "connector": {
            "service": "facebook_ads",
            "type": "facebook",
            "format": "json",
            "props": {
                "endpoint_url": "https://graph.facebook.com/v2.6/me/adaccounts?fields=id,name",
                "method": "GET",
                "qtype": "Graph API"
            }
        },
        "results": [{
            "propId": "ds.facebook_ads.accountId",
            "propField": "options",
            "labels": "/data/name",
            "values": "/data/id"
        }]
    }, {
        "id": "q2",
        "connector": {
            "service": "facebook_ads",
            "type": "facebook",
            "format": "json",
            "props": {
                "endpoint_url": "https://graph.facebook.com/v2.6/{{ds.facebook_ads.accountId}}/campaigns?fields=id,name,created_time,effective_status",
                "method": "GET"
            }
        },
        "results": [{
            "propId": "ds.facebook_ads.campaignId",
            "propField": "options",
            "labels": "/data/name[preceding-sibling::effective_status='ACTIVE']",
            "values": "/data/id[preceding-sibling::effective_status='ACTIVE']"
        }]
    }, {
        "id": "q3",
        "errorMessage": "Here are two suggestions:<br><br>1. Make sure you have access to your company's Google Analytics account. <br><br>2. From time to time, your Google OAuth token will expire. This token allows you to safely bring your data into Klipfolio. <a href='https://support.klipfolio.com/hc/en-us/articles/215548958-OAuth-token-expired-for-connected-accounts' target='_blank'>Find out how to re-authorize your OAuth tokens</a>.",
        "connector": {
            "service": "google_analytics",
            "type": "simple_rest",
            "format": "json",
            "props": {
                "endpoint_url": "https://www.googleapis.com/analytics/v3/management/accounts/~all/webproperties/~all/profiles?fields=items(id%2Cname%2Cpermissions%2CwebPropertyId%2CwebsiteUrl)",
                "method": "GET"
            }
        },
        "results": [{
            "propId": "ds.google_analytics.profileId",
            "propField": "options",
            "labels": "/items/name",
            "values": "/items/id"
        }]
    }, {
        "id": "q4",
        "connector": {
            "service": "google_analytics",
            "type": "simple_rest",
            "format": "json",
            "props": {
                "endpoint_url": "https://www.googleapis.com/analytics/v3/data/ga?ids=ga:{{ds.google_analytics.profileId}}&start-date=7daysAgo&end-date=today&metrics=ga:sessions&dimensions=ga:campaign",
                "method": "GET"
            }
        },
        "results": [{
            "propId": "ds.google_analytics.campaignName",
            "propField": "options",
            "labels": "kf:element_at(/rows,1)[contains(.,'Facebook')]",
            "values": "kf:element_at(/rows,1)[contains(.,'Facebook')]"
        }]
    }]
}
