{
    "name": "Localytics Revenue (Last 30 Days)",
    "description": "Compare your revenue to the number of users and sessions on your app. Originates from the Gallery.",
    "sampleFormulas": {
        "7a94c8de-2": {
            "txt": "array(\"31551\",\"148207\",\"39372\",\"93259\",\"108122\",\"130981\",\"93683\",\"148643\",\"75924\",\"96264\",\"66718\",\"128406\",\"58718\",\"104659\",\"30098\",\"68074\",\"33788\",\"4735\",\"51061\",\"42692\",\"22284\",\"12380\",\"134005\",\"69600\",\"145763\",\"17078\",\"112765\",\"20037\",\"29789\",\"111194\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "31551"
                    }, {
                        "t": "l",
                        "v": "148207"
                    }, {
                        "t": "l",
                        "v": "39372"
                    }, {
                        "t": "l",
                        "v": "93259"
                    }, {
                        "t": "l",
                        "v": "108122"
                    }, {
                        "t": "l",
                        "v": "130981"
                    }, {
                        "t": "l",
                        "v": "93683"
                    }, {
                        "t": "l",
                        "v": "148643"
                    }, {
                        "t": "l",
                        "v": "75924"
                    }, {
                        "t": "l",
                        "v": "96264"
                    }, {
                        "t": "l",
                        "v": "66718"
                    }, {
                        "t": "l",
                        "v": "128406"
                    }, {
                        "t": "l",
                        "v": "58718"
                    }, {
                        "t": "l",
                        "v": "104659"
                    }, {
                        "t": "l",
                        "v": "30098"
                    }, {
                        "t": "l",
                        "v": "68074"
                    }, {
                        "t": "l",
                        "v": "33788"
                    }, {
                        "t": "l",
                        "v": "4735"
                    }, {
                        "t": "l",
                        "v": "51061"
                    }, {
                        "t": "l",
                        "v": "42692"
                    }, {
                        "t": "l",
                        "v": "22284"
                    }, {
                        "t": "l",
                        "v": "12380"
                    }, {
                        "t": "l",
                        "v": "134005"
                    }, {
                        "t": "l",
                        "v": "69600"
                    }, {
                        "t": "l",
                        "v": "145763"
                    }, {
                        "t": "l",
                        "v": "17078"
                    }, {
                        "t": "l",
                        "v": "112765"
                    }, {
                        "t": "l",
                        "v": "20037"
                    }, {
                        "t": "l",
                        "v": "29789"
                    }, {
                        "t": "l",
                        "v": "111194"
                    }]
                }]
            }
        },
        "bdb49978-3": {
            "txt": "array(\"362\",\"1848\",\"638\",\"1581\",\"1447\",\"1685\",\"891\",\"954\",\"1906\",\"1870\",\"1047\",\"1857\",\"2088\",\"808\",\"956\",\"913\",\"1144\",\"1376\",\"1465\",\"1340\",\"1608\",\"1798\",\"1593\",\"668\",\"723\",\"939\",\"1784\",\"977\",\"693\",\"1284\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "362"
                    }, {
                        "t": "l",
                        "v": "1848"
                    }, {
                        "t": "l",
                        "v": "638"
                    }, {
                        "t": "l",
                        "v": "1581"
                    }, {
                        "t": "l",
                        "v": "1447"
                    }, {
                        "t": "l",
                        "v": "1685"
                    }, {
                        "t": "l",
                        "v": "891"
                    }, {
                        "t": "l",
                        "v": "954"
                    }, {
                        "t": "l",
                        "v": "1906"
                    }, {
                        "t": "l",
                        "v": "1870"
                    }, {
                        "t": "l",
                        "v": "1047"
                    }, {
                        "t": "l",
                        "v": "1857"
                    }, {
                        "t": "l",
                        "v": "2088"
                    }, {
                        "t": "l",
                        "v": "808"
                    }, {
                        "t": "l",
                        "v": "956"
                    }, {
                        "t": "l",
                        "v": "913"
                    }, {
                        "t": "l",
                        "v": "1144"
                    }, {
                        "t": "l",
                        "v": "1376"
                    }, {
                        "t": "l",
                        "v": "1465"
                    }, {
                        "t": "l",
                        "v": "1340"
                    }, {
                        "t": "l",
                        "v": "1608"
                    }, {
                        "t": "l",
                        "v": "1798"
                    }, {
                        "t": "l",
                        "v": "1593"
                    }, {
                        "t": "l",
                        "v": "668"
                    }, {
                        "t": "l",
                        "v": "723"
                    }, {
                        "t": "l",
                        "v": "939"
                    }, {
                        "t": "l",
                        "v": "1784"
                    }, {
                        "t": "l",
                        "v": "977"
                    }, {
                        "t": "l",
                        "v": "693"
                    }, {
                        "t": "l",
                        "v": "1284"
                    }]
                }]
            }
        },
        "01cbd48b-2": {
            "txt": "array(\"322\",\"1748\",\"538\",\"1381\",\"1247\",\"1185\",\"591\",\"654\",\"1606\",\"1470\",\"747\",\"1457\",\"1688\",\"508\",\"756\",\"613\",\"944\",\"1076\",\"1165\",\"1240\",\"1408\",\"1598\",\"1093\",\"568\",\"623\",\"639\",\"1484\",\"577\",\"293\",\"1084\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "322"
                    }, {
                        "t": "l",
                        "v": "1748"
                    }, {
                        "t": "l",
                        "v": "538"
                    }, {
                        "t": "l",
                        "v": "1381"
                    }, {
                        "t": "l",
                        "v": "1247"
                    }, {
                        "t": "l",
                        "v": "1185"
                    }, {
                        "t": "l",
                        "v": "591"
                    }, {
                        "t": "l",
                        "v": "654"
                    }, {
                        "t": "l",
                        "v": "1606"
                    }, {
                        "t": "l",
                        "v": "1470"
                    }, {
                        "t": "l",
                        "v": "747"
                    }, {
                        "t": "l",
                        "v": "1457"
                    }, {
                        "t": "l",
                        "v": "1688"
                    }, {
                        "t": "l",
                        "v": "508"
                    }, {
                        "t": "l",
                        "v": "756"
                    }, {
                        "t": "l",
                        "v": "613"
                    }, {
                        "t": "l",
                        "v": "944"
                    }, {
                        "t": "l",
                        "v": "1076"
                    }, {
                        "t": "l",
                        "v": "1165"
                    }, {
                        "t": "l",
                        "v": "1240"
                    }, {
                        "t": "l",
                        "v": "1408"
                    }, {
                        "t": "l",
                        "v": "1598"
                    }, {
                        "t": "l",
                        "v": "1093"
                    }, {
                        "t": "l",
                        "v": "568"
                    }, {
                        "t": "l",
                        "v": "623"
                    }, {
                        "t": "l",
                        "v": "639"
                    }, {
                        "t": "l",
                        "v": "1484"
                    }, {
                        "t": "l",
                        "v": "577"
                    }, {
                        "t": "l",
                        "v": "293"
                    }, {
                        "t": "l",
                        "v": "1084"
                    }]
                }]
            }
        },
        "145f2d79-21": {
            "txt": "array(\"2015-04-01\",\"2015-04-02\",\"2015-04-03\",\"2015-04-04\",\"2015-04-05\",\"2015-04-06\",\"2015-04-07\",\"2015-04-08\",\"2015-04-09\",\"2015-04-10\",\"2015-04-11\",\"2015-04-12\",\"2015-04-13\",\"2015-04-14\",\"2015-04-15\",\"2015-04-16\",\"2015-04-17\",\"2015-04-18\",\"2015-04-19\",\"2015-04-20\",\"2015-04-21\",\"2015-04-22\",\"2015-04-23\",\"2015-04-24\",\"2015-04-25\",\"2015-04-26\",\"2015-04-27\",\"2015-04-28\",\"2015-04-29\",\"2015-04-30\")",
            "src": {
                "t": "expr",
                "v": false,
                "c": [{
                    "t": "f",
                    "v": "array",
                    "c": [{
                        "t": "l",
                        "v": "2015-04-01"
                    }, {
                        "t": "l",
                        "v": "2015-04-02"
                    }, {
                        "t": "l",
                        "v": "2015-04-03"
                    }, {
                        "t": "l",
                        "v": "2015-04-04"
                    }, {
                        "t": "l",
                        "v": "2015-04-05"
                    }, {
                        "t": "l",
                        "v": "2015-04-06"
                    }, {
                        "t": "l",
                        "v": "2015-04-07"
                    }, {
                        "t": "l",
                        "v": "2015-04-08"
                    }, {
                        "t": "l",
                        "v": "2015-04-09"
                    }, {
                        "t": "l",
                        "v": "2015-04-10"
                    }, {
                        "t": "l",
                        "v": "2015-04-11"
                    }, {
                        "t": "l",
                        "v": "2015-04-12"
                    }, {
                        "t": "l",
                        "v": "2015-04-13"
                    }, {
                        "t": "l",
                        "v": "2015-04-14"
                    }, {
                        "t": "l",
                        "v": "2015-04-15"
                    }, {
                        "t": "l",
                        "v": "2015-04-16"
                    }, {
                        "t": "l",
                        "v": "2015-04-17"
                    }, {
                        "t": "l",
                        "v": "2015-04-18"
                    }, {
                        "t": "l",
                        "v": "2015-04-19"
                    }, {
                        "t": "l",
                        "v": "2015-04-20"
                    }, {
                        "t": "l",
                        "v": "2015-04-21"
                    }, {
                        "t": "l",
                        "v": "2015-04-22"
                    }, {
                        "t": "l",
                        "v": "2015-04-23"
                    }, {
                        "t": "l",
                        "v": "2015-04-24"
                    }, {
                        "t": "l",
                        "v": "2015-04-25"
                    }, {
                        "t": "l",
                        "v": "2015-04-26"
                    }, {
                        "t": "l",
                        "v": "2015-04-27"
                    }, {
                        "t": "l",
                        "v": "2015-04-28"
                    }, {
                        "t": "l",
                        "v": "2015-04-29"
                    }, {
                        "t": "l",
                        "v": "2015-04-30"
                    }]
                }]
            }
        }
    },
    "datasources": {
        "localytics": {
            "service": "localytics",
            "type": "simple_rest",
            "format": "json",
            "name": "Localytics Revenue (Last 30 Days)",
            "libraryAlias": "LocalyticsRevenueLast30Days",
            "refreshInterval": 14400,
            "description": "Retrieve users, sessions, and revenue for an app over last 30 days. Originates from the Gallery.",
            "props": {
                "auth_method": "basic",
                "basic_auth_username": "{{auth.localytics.apiKey}}",
                "basic_auth_password": "{{auth.localytics.apiSecret}}",
                "endpoint_url": "https://api.localytics.com/v1/query?app_id={{ds.localytics.appId}}&metrics=sessions,users,revenue&dimensions=day&conditions=%7B%22day%22%3A%5B%22between%22%2C%22{date.add(-30).format()}%22%2C%22{date.yesterday}%22%5D%7D",
                "method": "get",
                "parameters": "[]"
            }
        }
    },

    "dsMappings": {
        "localytics": "395ff8eb07eb66bc6000KavyaMallur9"
    },

    "services": [{
        "service": "localytics"
    }],

    "datasourceConfigModel": [{
        "type": "select",
        "id": "ds.localytics.appId",
        "label": "App",
        "description": "Select your Localytics App.",
        "isRequired": true
    }],
    "queries": [{
        "errorMessage": "Make sure you have the correct Localytics API Key and API Secret. Check out <a href='http://klipfolio.uservoice.com/knowledgebase/articles/809421-klip-gallery-localytics#connect' target='_blank'>Klip Gallery: Localytics</a> for more information.",
        "connector": {
            "service": "localytics",
            "type": "simple_rest",
            "format": "json",
            "props": {
                "auth_method": "basic",
                "basic_auth_username": "{{auth.localytics.apiKey}}",
                "basic_auth_password": "{{auth.localytics.apiSecret}}",
                "endpoint_url": "https://api.localytics.com/v1/apps",
                "method": "get",
                "parameters": "[]"
            }
        },
        "results": [{
            "propId": "ds.localytics.appId",
            "propField": "options",
            "labels": "//*/apps/name",
            "values": "//*/apps/app_id"
        }]
    }]
}
